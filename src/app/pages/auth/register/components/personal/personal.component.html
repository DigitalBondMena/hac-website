<form
  [formGroup]="registerForm"
  (ngSubmit)="submition()"
  @formAnimation
  [@shake]="shakeState()"
>
  <figure class="mb-[30px] block" @iconAnimation>
    <img
      width="63px"
      height="63px"
      loading="lazy"
      src="/images/common/username.webp"
      alt=""
    />
  </figure>
  <!-- Form Fields Container -->
  <div @fieldAnimation>
    <!-- Full Name  -->
    <div class="flex justify-between items-start gap-x-[23px] mb-[44px]">
      <!-- First Name  -->
      <div class="flex-grow-1 w-full">
        <label
          for="firstName"
          class="block relative text-subtitle-size font-bold mb-[23px] after:absolute after:content-['*'] after:-top-[6px] ltr:after:right-0 rtl:after:left-0 w-fit after:text-muted-rose after:transform after:translate-x-full rtl:after:-translate-x-full after:font-bold after:text-[30px]"
        >
          {{ "contact-us.form.first-name" | translate }}
        </label>
        <input
          formControlName="firstName"
          type="text"
          id="firstName"
          class="bg-white border border-[#8D8D8D] rounded-[15px] rtl:pr-4 ltr:pl-4 py-[18px] w-full"
          [class.border-red-500]="firstName?.invalid && firstName?.touched"
          [placeholder]="'contact-us.form.placeholder-first-name' | translate"
        />
        @if (firstName?.invalid && firstName?.touched) {
        <div class="text-red-500 mt-2 text-sm">
          @if (firstName?.errors?.['required']) {
          <p>{{ "validation.name-required" | translate }}</p>
          }
        </div>
        }
      </div>
      <!-- Last Name  -->
      <div class="flex-grow-1 w-full">
        <label
          for="lastName"
          class="block relative text-subtitle-size font-bold mb-[23px] after:absolute after:content-['*'] after:-top-[6px] ltr:after:right-0 rtl:after:left-0 w-fit after:text-muted-rose after:transform after:translate-x-full rtl:after:-translate-x-full after:font-bold after:text-[30px]"
        >
          {{ "contact-us.form.last-name" | translate }}
        </label>
        <input
          formControlName="lastName"
          type="text"
          id="lastName"
          class="bg-white border border-[#8D8D8D] rounded-[15px] rtl:pr-4 ltr:pl-4 py-[18px] w-full"
          [class.border-red-500]="lastName?.invalid && lastName?.touched"
          [placeholder]="'contact-us.form.placeholder-last-name' | translate"
        />
        @if (lastName?.invalid && lastName?.touched) {
        <div class="text-red-500 mt-2 text-sm">
          @if (lastName?.errors?.['required']) {
          <p>{{ "validation.name-required" | translate }}</p>
          }
        </div>
        }
      </div>
    </div>

    <!-- Phone Number -->
    <div class="mb-[41px]">
      <label
        for="phone"
        class="block relative text-subtitle-size font-bold mb-[23px] after:absolute after:content-['*'] after:-top-[6px] ltr:after:right-0 rtl:after:left-0 w-fit after:text-muted-rose after:transform after:translate-x-full rtl:after:-translate-x-full after:font-bold after:text-[30px]"
      >
        {{ "contact-us.form.phone-number" | translate }}
      </label>
      <div
        class="flex items-center border border-[#8D8D8D] rounded-[15px] overflow-hidden"
      >
        <p
          class="bg-[#eee] text-[#333] px-3 py-[19px] text-description-size ltr:-order-1 rtl:order-1"
        >
          +966
        </p>
        <input
          type="text"
          formControlName="phone"
          id="phone-number"
          class="flex-1 bg-white py-[18px] rtl:pr-4 ltr:pl-4 w-full rtl:text-right ltr:text-left focus:outline-none"
          [placeholder]="'contact-us.form.placeholder-phone-number' | translate"
          autocomplete="tel"
          aria-required="true"
        />
      </div>

      <!-- Validation messages -->
      @if (registerForm.get('phone')?.invalid &&
      registerForm.get('phone')?.touched) {
      <div class="mt-2 text-red-500">
        @if (registerForm.get('phone')?.errors?.['required']) {
        <p>{{ "validation.phone-required" | translate }}</p>
        } @if (registerForm.get('phone')?.errors?.['pattern']) {
        <p>{{ "validation.phone-pattern-example" | translate }}</p>
        }
      </div>
      }
    </div>

    <!-- Email -->
    <div class="mb-[41px]">
      <label
        for="email"
        class="block relative text-subtitle-size font-bold mb-[23px] after:absolute after:content-['*'] after:-top-[6px] ltr:after:right-0 rtl:after:left-0 w-fit after:text-muted-rose after:transform after:translate-x-full rtl:after:-translate-x-full after:font-bold after:text-[30px]"
      >
        {{ "contact-us.form.email" | translate }}
      </label>
      <input
        formControlName="email"
        type="email"
        id="email"
        class="bg-white border border-[#8D8D8D] rounded-[15px] rtl:pr-4 ltr:pl-4 py-[18px] w-full"
        [class.border-red-500]="email?.invalid && email?.touched"
        [placeholder]="'contact-us.form.placeholder-email' | translate"
      />
      @if (email?.invalid && email?.touched) {
      <div class="text-red-500 mt-2 text-sm">
        @if (email?.errors?.['required']) {
        <p>{{ "validation.email-required" | translate }}</p>
        } @if (email?.errors?.['email']) {
        <p>{{ "validation.email-format" | translate }}</p>
        }
      </div>
      }
    </div>
    <!-- Password -->
    <div class="mb-[41px]">
      <label
        for="password"
        class="block relative text-subtitle-size font-bold mb-[23px] after:absolute after:content-['*'] after:-top-[6px] ltr:after:right-0 rtl:after:left-0 w-fit after:text-muted-rose after:transform after:translate-x-full rtl:after:-translate-x-full after:font-bold after:text-[30px]"
      >
        {{ "auth.login.login-form.password" | translate }}
      </label>
      <input
        formControlName="password"
        type="password"
        id="password"
        class="bg-white border border-[#8D8D8D] rounded-[15px] rtl:pr-4 ltr:pl-4 py-[18px] w-full"
        [class.border-red-500]="password?.invalid && password?.touched"
        [placeholder]="'auth.login.login-form.password-placeholder' | translate"
      />
      @if (password?.invalid && password?.touched) {
      <div class="text-red-500 mt-2 text-sm">
        @if (password?.errors?.['required']) {
        <p>{{ "Password_required" | translate }}</p>
        } @if (password?.errors?.['minlength']) {
        <p>{{ "Password_characters" | translate }}</p>
        }
      </div>
      }
    </div>
    <!-- Confirm Password -->
    <div class="mb-[41px]">
      <label
        for="confirmPassword"
        class="block relative text-subtitle-size font-bold mb-[23px] after:absolute after:content-['*'] after:-top-[6px] ltr:after:right-0 rtl:after:left-0 w-fit after:text-muted-rose after:transform after:translate-x-full rtl:after:-translate-x-full after:font-bold after:text-[30px]"
      >
        {{ "profile.password.confirm-password" | translate }}
      </label>
      <input
        formControlName="confirmPassword"
        type="password"
        id="confirmPassword"
        class="bg-white border border-[#8D8D8D] rounded-[15px] rtl:pr-4 ltr:pl-4 py-[18px] w-full"
        [class.border-red-500]="
          confirmPassword?.invalid && confirmPassword?.touched
        "
        [placeholder]="
          'profile.password.placeholder-confirm-password' | translate
        "
      />
      @if (confirmPassword?.invalid && confirmPassword?.touched) {
      <div class="text-red-500 mt-2 text-sm">
        @if (confirmPassword?.errors?.['required']) {
        <p>{{ "validation.password-required" | translate }}</p>
        } @if (confirmPassword?.errors?.['passwordMismatch']) {
        <p>{{ "validation.password-mismatch" | translate }}</p>
        }
      </div>
      }
    </div>
  </div>

  <!-- Business-specific fields (shown only when registering as business) -->
  <div *ngIf="userRole === UserRole.BUSINESS" class="mb-6 business-fields">
    <h3 class="text-xl font-semibold mb-4">
      {{ "auth.register.register-form.personal.business-info" | translate }}
    </h3>

    <!-- Trade Name -->
    <div class="mb-[41px]">
      <label
        for="trade_name"
        class="block relative text-subtitle-size font-bold mb-[23px] after:absolute after:content-['*'] after:-top-[6px] ltr:after:right-0 rtl:after:left-0 w-fit after:text-muted-rose after:transform after:translate-x-full rtl:after:-translate-x-full after:font-bold after:text-[30px]"
      >
        {{
          "auth.register.register-form.personal.business.trade-name.label"
            | translate
        }}
      </label>
      <input
        formControlName="trade_name"
        type="text"
        id="trade_name"
        class="bg-white border border-[#8D8D8D] rounded-[15px] rtl:pr-4 ltr:pl-4 py-[18px] w-full"
        [class.border-red-500]="tradeName?.invalid && tradeName?.touched"
        [placeholder]="
          'auth.register.register-form.personal.business.trade-name.placeholder'
            | translate
        "
      />
      @if (tradeName?.invalid && tradeName?.touched) {
      <div class="text-red-500 mt-2 text-sm">
        @if (tradeName?.errors?.['required']) {
        <p>
          {{
            "auth.register.register-form.personal.business.trade-name.required"
              | translate
          }}
        </p>
        }
      </div>
      }
    </div>

    <!-- National Address -->
    <div class="mb-[41px]">
      <label
        for="national_address"
        class="block relative text-subtitle-size font-bold mb-[23px] after:absolute after:content-['*'] after:-top-[6px] ltr:after:right-0 rtl:after:left-0 w-fit after:text-muted-rose after:transform after:translate-x-full rtl:after:-translate-x-full after:font-bold after:text-[30px]"
      >
        {{
          "auth.register.register-form.personal.business.national-address.label"
            | translate
        }}
      </label>
      <input
        formControlName="national_address"
        type="text"
        id="national_address"
        class="bg-white border border-[#8D8D8D] rounded-[15px] rtl:pr-4 ltr:pl-4 py-[18px] w-full"
        [class.border-red-500]="
          nationalAddress?.invalid && nationalAddress?.touched
        "
        [placeholder]="
          'auth.register.register-form.personal.business.national-address.placeholder'
            | translate
        "
      />
      @if (nationalAddress?.invalid && nationalAddress?.touched) {
      <div class="text-red-500 mt-2 text-sm">
        @if (nationalAddress?.errors?.['required']) {
        <p>
          {{
            "auth.register.register-form.personal.business.national-address.required"
              | translate
          }}
        </p>
        }
      </div>
      }
    </div>

    <!-- Commercial File -->
    <div class="mb-[41px]">
      <label
        for="commercial_file"
        class="block relative text-subtitle-size font-bold mb-[23px] after:absolute after:content-['*'] after:-top-[6px] ltr:after:right-0 rtl:after:left-0 w-fit after:text-muted-rose after:transform after:translate-x-full rtl:after:-translate-x-full after:font-bold after:text-[30px]"
      >
        {{
          "auth.register.register-form.personal.business.commercial-file.label"
            | translate
        }}
      </label>
      <input
        type="file"
        id="commercial_file"
        class="bg-white border border-[#8D8D8D] rounded-[15px] rtl:pr-4 ltr:pl-4 py-[18px] w-full"
        [class.border-red-500]="commercialFileRequired && !commercialFile"
        (change)="onCommercialFileChange($event)"
      />
      @if (commercialFileRequired && !commercialFile) {
      <div class="text-red-500 mt-2 text-sm">
        <p>
          {{
            "auth.register.register-form.personal.business.commercial-file.required"
              | translate
          }}
        </p>
      </div>
      }
    </div>

    <!-- VAT File -->
    <div class="mb-[41px]">
      <label
        for="vat_file"
        class="block relative text-subtitle-size font-bold mb-[23px] after:absolute after:content-['*'] after:-top-[6px] ltr:after:right-0 rtl:after:left-0 w-fit after:text-muted-rose after:transform after:translate-x-full rtl:after:-translate-x-full after:font-bold after:text-[30px]"
      >
        {{
          "auth.register.register-form.personal.business.vat-file.label"
            | translate
        }}
      </label>
      <input
        type="file"
        id="vat_file"
        class="bg-white border border-[#8D8D8D] rounded-[15px] rtl:pr-4 ltr:pl-4 py-[18px] w-full"
        [class.border-red-500]="vatFileRequired && !vatFile"
        (change)="onVatFileChange($event)"
      />
      @if (vatFileRequired && !vatFile) {
      <div class="text-red-500 mt-2 text-sm">
        <p>
          {{
            "auth.register.register-form.personal.business.vat-file.required"
              | translate
          }}
        </p>
      </div>
      }
    </div>
  </div>

  <div class="flex justify-between items-center" @pulse>
    <app-button
      [px]="'px-[84px]'"
      [py]="'py-[9px]'"
      [title]="'routes.register' | translate"
      [type]="'submit'"
      [disabled]="isLoading || registerForm.invalid"
    >
      @if (isLoading) {
      <!-- <span class="ml-2">{{ "routes.register" | translate }}</span> -->
      }
    </app-button>

    <span
      [routerLink]="['/', currentLang$ | async, 'login']"
      class="text-muted-rose text-description-size capitalize cursor-pointer"
    >
      {{
        "auth.register.register-form.personal.genders.haveAccount" | translate
      }}
    </span>
  </div>
</form>
